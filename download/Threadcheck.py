import os
import threading
import time
url_index = ["https://mirrors.sustech.edu.cn/pypi/simple","https://mirrors.ustc.edu.cn/pypi/web/simple","https://pypi.tuna.tsinghua.edu.cn/simple"]

def Thread_url(pkg,index):
    command = cmd +" "+ url_index[index] +" "+pkg
    print(command)
    f = os.popen(command)
    print("result is")
    time.sleep(2)
    print(f.read())

pkg_index = []
f = open("pkg.txt")
line = f.readline()
while line:
    print (line)
    pkg_index.append(line)
    line = f.readline()
f.close()

cmd = "sudo pip3 download -i"
threads=[]
for pkg in pkg_index:
    try:
        th = threading.Thread(target=Thread_url,args=(pkg,1))
        th.start()
        threads.append(th)
        th = threading.Thread(target=Thread_url,args=(pkg,2))
        th.start()
        threads.append(th)
        th = threading.Thread(target=Thread_url,args=(pkg,0))
        th.start()
        threads.append(th)
    except:
        print("Error: unable to start thread")
    for th in threads:
        th.join()
